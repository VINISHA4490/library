'use strict';mix_d("MorpheusPopularityRankSidesheetCards__morpheus-popularity-rank-sidesheet-card:morpheus-popularity-rank-sidesheet-card__IyFC-ONl","exports tslib @c/browser-operations @c/logger @c/scoped-dom @p/monarch-sidesheet @c/metrics @c/remote-operations @p/A".split(" "),function(I,n,C,U,V,W,X,Y,Z){function x(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var aa=x(C),N=x(U),m=x(V),A=x(W);C=x(Y);var ba=x(Z),v=function(a,b){void 0===b&&(b=1);X.count(a,b)},ca=function(a){return n.__awaiter(void 0,
void 0,void 0,function(){var b,c;return n.__generator(this,function(d){a.classList.contains("morpheusAodEntryLink")&&!a.classList.contains("morpheusAodDeclarativeAction")&&(A["default"].closeSidesheet(a.id),b=null===(c=a.parentElement)||void 0===c?void 0:c.getElementsByClassName("morpheusAodDeclarativeAction")[0])&&(b.click(),v("morpheusAODClicked"));return[2]})})},y;(function(a){a.editionClickHandler="editionClickHandler";a.aodLinkClickHandler="aodLinkClickHandler";a.ingressLinkClickHandler="ingressLinkClickHandler";
a.formatPillClickHandler="formatPillClickHandler"})(y||(y={}));var z=function(a){J(a)&&a.classList.add("aok-hidden")},D=function(a){J(a)||a.classList.remove("aok-hidden")},J=function(a){return a&&!a.classList.contains("aok-hidden")},O=function(a){try{var b=a.split("products/")[1].split("/");var c=null===b||void 0===b?void 0:b[0]}catch(h){throw Error("Failed to extract ASIN from URI "+a);}var d=new URLSearchParams(a.split("?")[1]);a=d.get("pageSize");b=d.get("pageNumber");var f=d.get("selectedFormats");
d=d.get("sortBy");return{asin:c,pageSize:null!==a?Number(a):void 0,pageNumber:null!==b?Number(b):void 0,selectedFormats:null!==f?JSON.parse(decodeURIComponent(f)):void 0,sortBy:null!==d?d:void 0}},w;(function(a){a.INGRESS_LINK_CLICK="Morpheus.Desktop.IngressLinkClick";a.FORMAT_PILL_CLICK="Morpheus.Desktop.FormatPillClick";a.PAGINATION_PILL_CLICK="Morpheus.Desktop.PaginationPillClick";a.INGRESS_LINK_CLICK_ERROR="Morpheus.Desktop.IngressLinkClick.Error";a.FORMAT_PILL_CLICK_ERROR="Morpheus.Desktop.FormatPillClick.Error";
a.PAGINATION_PILL_CLICK_ERROR="Morpheus.Desktop.PaginationPillClick.Error"})(w||(w={}));var t;(function(a){a.INGRESS="morpheus-sidesheet-ingress";a.CLOSE="morpheus-sidesheet-close";a.ROOT="morpheusRoot";a.SIDESHEET="morpheus-sidesheet";a.SIDESHEET_BODY="morpheus-sidesheet-main-body";a.SIDESHEET_SPINNER="morpheus-sidesheet-spinner";a.SIDESHEET_ERROR_VIEW="morpheus-sidesheet-error-view";a.SIDESHEET_BACKGROUND="morpheus-darkened-background";a.SIDESHEET_CONTENT="morpheus-sidesheet-content-container"})(t||
(t={}));var da=function(){var a=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_BODY+' div[class*="sidesheetAsinListContainer"]:not([style*="display: none;"]) div[class*="pagination-section"] div');if(a){var b;(b=(b=m["default"].cardRoot.querySelector("tag-pill[selected]"))?b.tagName.replace(/(\([0-9]*\))/g,"").trim():"")&&a.setAttribute("aria-label",b)}},Q=function(a,b){for(var c=a.getElementsByClassName("_bW9yc_pagination_2YDti")[0],d=a.getElementsByClassName("a-pagination")[0].getElementsByTagName("li"),
f=function(k){var g=d[k];g.classList.contains("a-disabled")||g.addEventListener("click",function(l){l.preventDefault();l=g&&g.classList.contains("a-selected");var e=d[d.length-2];if(!l&&e&&e.dataset.pageNumber){a:{var u=Number(e.dataset.pageNumber);switch(!0){case 2>=u:u="morpheusSidesheetOtherPageNavigated.1To2Pages";break a;case 2<u&&5>=u:u="morpheusSidesheetOtherPageNavigated.3To5Pages";break a;default:u="morpheusSidesheetOtherPageNavigated.MoreThan5Pages"}}v(u)}var q;0===k&&c.dataset.prevPageNumber?
q=Number(c.dataset.prevPageNumber):k===d.length-1&&c.dataset.nextPageNumber?q=Number(c.dataset.nextPageNumber):g&&g.dataset.pageNumber&&(q=Number(g.dataset.pageNumber));g&&!l&&q&&(v("morpheusSidesheetOtherPageNavigated"),(b||e&&e.dataset.pageNumber)&&P({contentElement:a,metrics:{operation:w.PAGINATION_PILL_CLICK,error:w.PAGINATION_PILL_CLICK_ERROR},currentPageNumber:q}))})},h=0;h<d.length;h++)f(h);da()},E=new Set,K="",F=function(a){a&&(a.style.display="none")},G=function(){var a=m["default"].cardRoot.querySelector("#"+
t.SIDESHEET_SPINNER),b=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_ERROR_VIEW);z(b);D(a);return a},B=function(){var a=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_SPINNER),b=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_ERROR_VIEW);z(a);D(b)},H=function(){var a=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_SPINNER),b=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_ERROR_VIEW);z(a);z(b)},R=function(a,b){if(b){b.scrollIntoView({block:"nearest"});b=b.getBoundingClientRect();
var c=a.getBoundingClientRect();c.left+20>b.left?a.scrollLeft-=20:c.right-20<b.right&&(a.scrollLeft+=20)}},S=C["default"].setup(),L=function(a){a=a.querySelector(".sidesheetAsinListContainer");z(a)},P=function(a){return n.__awaiter(void 0,void 0,void 0,function(){var b,c,d,f,h,k,g,l,e,u,q,r;return n.__generator(this,function(p){switch(p.label){case 0:G();a.selectedFormatInfo||(b=m["default"].cardRoot.getElementsByClassName("_bW9yc_sidesheet_18DM8")[0],c=b.querySelector("tag-pill[selected]"),d=null===
c||void 0===c?void 0:c.getAttribute("tagid"),f=b.querySelector("#"+d+"._bW9yc_pill-content_2rpOw"),a.selectedFormatInfo={htmlElement:c,id:d,previousEditionsListHtmlElement:f},L(a.selectedFormatInfo.previousEditionsListHtmlElement),v(a.metrics.operation+"."+a.currentPageNumber));K=h=a.selectedFormatInfo.id;k=a.selectedFormatInfo.htmlElement.getElementsByClassName("formatReference")[0];g=k.value;l=O(g);v(a.metrics.operation+"."+(null===(q=l.selectedFormats)||void 0===q?void 0:q[0]));if(E.has(h))return[2];
a.currentPageNumber&&(l.pageNumber=a.currentPageNumber);p.label=1;case 1:return p.trys.push([1,3,4,5]),E.add(h),[4,S.getPageHTML(n.__assign({},l))];case 2:return e=p.sent(),u=e.querySelector("#"+h+".a-row"),a.contentElement.innerHTML=u.innerHTML,Q(a.contentElement),K!==h&&L(a.contentElement),H(),[3,5];case 3:return p.sent(),B(),v(a.metrics.error),v(a.metrics.error+"."+(null===(r=l.selectedFormats)||void 0===r?void 0:r[0])),[3,5];case 4:return E.delete(h),[7];case 5:return[2]}})})},ea=function(a,b){return n.__awaiter(void 0,
void 0,void 0,function(){var c,d,f,h,k,g,l;return n.__generator(this,function(e){switch(e.label){case 0:c=null===(l=b.querySelector('input.selectedFormat[value="true"]'))||void 0===l?void 0:l.getAttribute("name");if(!c)return B(),[2];G();d=b.querySelector("[id='"+c+"']._bW9yc_pill-content_2rpOw");if(!d)return H(),B(),[2];f=d.querySelector(".sidesheetAsinListContainer");f.innerHTML="";h=O(a);e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,S.getPageHTML(n.__assign({},h))];case 2:return k=e.sent(),
g=k.querySelector("[id='"+c+"'].a-row"),d.innerHTML=g.innerHTML,[3,5];case 3:return e.sent(),B(),[3,5];case 4:return H(),[7];case 5:return[2]}})})},fa=function(a,b){return n.__awaiter(void 0,void 0,void 0,function(){var c,d,f,h,k,g,l;return n.__generator(this,function(e){v(w.FORMAT_PILL_CLICK);c=b.querySelector("tag-pill[selected]");d=null===c||void 0===c?void 0:c.getAttribute("tagid");K=f=null===a||void 0===a?void 0:a.getAttribute("tagid");e=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_ERROR_VIEW);
if(!J(e)&&d===f)return[2];h=b.querySelector("._bW9yc_pill-row_2E5A6");R(h,a);null===c||void 0===c?void 0:c.removeAttribute("selected");a.setAttribute("selected","true");k=b.querySelector("#"+d+"._bW9yc_pill-content_2rpOw");L(k);if(E.has(f))return G(),[2];g=b.querySelector("#"+f+"._bW9yc_pill-content_2rpOw");if(l=g.querySelector(".sidesheetAsinListContainer"))return l.scrollIntoView(),D(l),a.focus(),H(),[2];P({contentElement:g,metrics:{operation:w.FORMAT_PILL_CLICK,error:w.FORMAT_PILL_CLICK_ERROR},
selectedFormatInfo:{htmlElement:a,id:f}});a.focus();return[2]})})},ha=function(a){var b=a.querySelector("._bW9yc_pill-row_2E5A6"),c=a.querySelectorAll("tag-pill"),d=a.querySelector("._bW9yc_pill-scroll-back_5azJs"),f=a.querySelector("._bW9yc_pill-scroll-forward_1fyk7"),h;if(d&&f&&b){var k=d.offsetLeft>f.offsetLeft,g=k&&20<b.scrollLeft;F(d);var l=function(){return g?20>=Math.abs(b.scrollLeft):20>=b.scrollWidth-Math.abs(b.scrollLeft)-b.offsetWidth},e=function(){return g?20>=b.scrollWidth-Math.abs(b.scrollLeft)-
b.offsetWidth:20>=Math.abs(b.scrollLeft)};l()&&F(f);R(b,a.querySelector("tag-pill[selected]"));b.addEventListener("scroll",function(){l()&&"none"!==f.style.display?F(f):!l()&&"none"===f.style.display&&f&&(f.style.display="block");e()&&"none"!==d.style.display?F(d):!e()&&"none"===d.style.display&&d&&(d.style.display="block")});var u=function(r){for(var p=0;p<c.length;p++)if(c[p].getBoundingClientRect().left<r.left&&(k||p==c.length-1||!(c[p+1].getBoundingClientRect().left<r.left))){h=p;break}c[h].scrollIntoView({block:"nearest"});
b.scrollLeft-=20},q=function(r){for(var p=0;p<c.length;p++)if(c[p].getBoundingClientRect().right>r.right&&!(k&&p!=c.length-1&&c[p+1].getBoundingClientRect().right>r.right)){h=p;break}c[h].scrollIntoView({block:"nearest"});b.scrollLeft+=20};f.addEventListener("click",function(){var r=b.getBoundingClientRect();k?u(r):q(r)});d.addEventListener("click",function(){var r=b.getBoundingClientRect();k?q(r):u(r)})}},ia=function(a,b){return n.__awaiter(void 0,void 0,void 0,function(){var c;return n.__generator(this,
function(d){c=b.value;if(!c)return[2];ea(c,a);return[2]})})},ja=C["default"].setup(),ka=function(){return n.__awaiter(void 0,void 0,void 0,function(){var a,b,c,d,f,h,k,g,l,e,u;return n.__generator(this,function(q){switch(q.label){case 0:v(w.INGRESS_LINK_CLICK);a=m["default"].cardRoot.getElementsByClassName("_bW9yc_sidesheet_18DM8")[0];b=m["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];c=m["default"].cardRoot.getElementsByClassName("landingAsinValue")[0];if(!a||!c||!c.value)return N["default"].log("Not able to open see all formats sidesheet, missing necessary component.",
"FATAL"),[2];if(d=a.querySelector("tag-pill[selected]")){A["default"].show();f=null===d||void 0===d?void 0:d.getAttribute("tagid");h=a.querySelector("#"+f+"._bW9yc_pill-content_2rpOw");if(k=h.querySelector(".sidesheetAsinListContainer"))b.scrollIntoView(),D(k);return[2]}A["default"].show();g=c.value;l=G();q.label=1;case 1:return q.trys.push([1,3,,4]),[4,ja.getPageHTML({asin:g})];case 2:e=q.sent();z(l);b.innerHTML=e.outerHTML;d=a.querySelector("tag-pill[selected]");f=null===d||void 0===d?void 0:d.getAttribute("tagid");
v(w.INGRESS_LINK_CLICK+"."+f);if(T())ba["default"].on("a:dropdown:selected:sortingDropdown",function(r){ia(a,r)});else u=a.querySelector("#"+f+"._bW9yc_pill-content_2rpOw"),Q(u),setTimeout(function(){return ha(b)},0);return[3,4];case 3:return q.sent(),B(),v(w.INGRESS_LINK_CLICK_ERROR),[3,4];case 4:return[2]}})})},M=!1,T=function(){var a;return 0<(null===(a=m["default"].cardRoot.getElementsByClassName("isDesktopCXImprovementsPhaseTwoWeblabEnabled"))||void 0===a?void 0:a.length)};I._operationNames=
["getPageHTML"];I.card=function(){return n.__awaiter(void 0,void 0,void 0,function(){var a,b,c,d,f,h,k,g;return n.__generator(this,function(l){a=m["default"].cardRoot.querySelector("#"+t.ROOT);if(!a)return[2];b=m["default"].cardRoot.querySelector("#"+t.SIDESHEET);c=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_BODY);d=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_BACKGROUND);f=m["default"].cardRoot.querySelector("#"+t.SIDESHEET_SPINNER);h=m["default"].cardRoot.querySelector("#"+t.CLOSE);
k=[b,c,d,f,h];if(k.every(function(e){return e})&&k.map(function(e){return e.id}).every(function(e){return e}))A["default"].initialize.apply(A["default"],n.__spread(k.map(function(e){return e.id}))),h.tabIndex=0;else return N["default"].log("Not able to initialize see all formats sidesheet, missing necessary component or component id.","FATAL"),[2];g=aa["default"].setup().define;g(y.editionClickHandler,"click",function(){v("morpheusEditionItemClicked")});g(y.aodLinkClickHandler,"click",function(e){ca(e.target)});
g(y.ingressLinkClickHandler,"click",function(){return n.__awaiter(void 0,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:if(M)return[3,2];M=!0;return[4,ka()];case 1:e.sent(),M=!1,e.label=2;case 2:return[2]}})})});g(y.formatPillClickHandler,"click",function(e){fa(e.target,b)});return[2]})})};I.isDesktopCXImprovementsPhaseTwoWeblabEnabledFunc=T});
